<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="../image/favicon.ico">
    <link rel="stylesheet" href="../style/core.css">
    <link rel="stylesheet" href="../style/login.css">
    <title>Login - MorbidiSense App</title>
    <!-- Load navigation system -->
    <script src="../scripts/navigation.js" defer></script>
    <script src="../scripts/loadTemplates.js" defer></script>
</head>
<body class="login-page">
    <!-- Header placeholder will be loaded here -->
    <div id="header-placeholder"></div>
    
    <!-- Main content -->
    <main class="main-content">
        <div class="login-container">
            <div class="login-box">
                <div class="login-img">
                    <img src="../image/login-image.jpg" alt="Login illustration">
                </div>
                <form class="login-form" onsubmit="event.preventDefault(); login();">
                    <div id="message" class="message"></div>
                    <img src="../image/logo-img.jpg" alt="MorbidiSense Logo" class="logo">
                    <h1 class="title">Login - MorbidiSense</h1>
                    <div class="form-group">
                        <input type="text" id="txt-username" placeholder="Username" required>
                    </div>
                    <div class="form-group password-field">
                        <input type="password" id="pwd" placeholder="Password" required>
                        <button type="button" class="toggle-password" aria-label="Toggle password visibility">
                            <i class="fa fa-eye"></i>
                        </button>
                    </div>
                    <button type="submit" class="login-btn">Login</button>
                    <div class="register-link">
                        Don't have an account? <a href="register.html" data-route="register">Register here</a>
                    </div>
                </form>
            </div>
        </div>
    </main>
    <!-- Page transition overlay -->
    <div id="page-transition" class="page-transition">
        <div class="loader"></div>
    </div>
    
    <!-- Load auth script -->
    <script src="../scripts/auth.js"></script>
    
    <script>
        // Override the default login redirect to use our navigation system
        window.login = async function() {
            const username = document.getElementById('txt-username').value;
            const password = document.getElementById('pwd').value;
            const messageDiv = document.getElementById('message');
            const loader = document.querySelector('.page-transition');

            if (!username || !password) {
                showMessage('Please enter both username and password', 'error');
                return;
            }

            try {
                if (loader) loader.classList.add('active');
                
                // Simulate API call with delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // For demo purposes, accept any non-empty credentials
                showMessage('Login successful! Redirecting...', 'success');
                
                // Use our navigation system to redirect
                setTimeout(() => {
                    window.NavigationService.navigateTo('home');
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                showMessage('Invalid username or password', 'error');
            } finally {
                if (loader) loader.classList.remove('active');
            }
        };
        
        // Toggle password visibility
        document.addEventListener('click', function(e) {
            if (e.target.closest('.toggle-password')) {
                const passwordInput = e.target.closest('.password-field').querySelector('input');
                const icon = e.target.closest('.toggle-password').querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            }
        });
        
        // Show message function
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            if (messageDiv) {
                messageDiv.textContent = message;
                messageDiv.className = 'message ' + type;
                messageDiv.style.display = 'block';
                
                // Hide message after 5 seconds
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }
        }
    </script>
</body>
</html>
